# N6.1 – RSS Legality Guardrails

## 1. Legal Metadata Requirements
- Every entry in `configs/news_sources.yml` must define:
  - `license`: short identifier for the publisher’s RSS license/TOS.
  - `redistribution_allowed`: boolean indicating whether downstream storage and surfacing is permitted.
  - `robots_policy`: declared crawler posture (`follow`, `robots`, `ignore`, etc).
- The loader (`app/models/news_sources.py`) enforces the presence and type of these fields, logging `news_source_missing_legal_metadata` or `news_source_invalid_redistribution_flag` when values are absent or malformed. Missing metadata does not break ingest but is surfaced for remediation.

## 2. Pre-Ingest Compliance Gate
- `NewsIngestService.ingest_source()` evaluates each source before fetching:
  1. `redistribution_allowed=False` ⇒ immediate skip with `news_ingest_legal_validation_failed` + `news_ingest_legal_skip`.
  2. X-Robots-Tag headers (`noai`, `nosnippet`, `noindex`, `none`, `noarchive`) fetched via HEAD/GET cause a skip.
  3. When `robots_policy` requests compliance, `/robots.txt` is downloaded and parsed; any `Disallow` matching the feed path yields `robots_txt_block`.
- Failed checks increment `news_source_state` failures so cooldown/backoff mirrors network faults. Successful checks log `news_ingest_legal_validation_passed`.

## 3. Allowed vs Forbidden Fields
- **Allowed downstream fields:** `title`, sanitized `snippet` (≤360 chars, HTML stripped), `url`, `source`, `published_at`.
- **Forbidden / stripped before persistence:**
  - Full article bodies (`content`, `description`, `summary` with heavy HTML).
  - Media payloads (`media_content`, `enclosures`, thumbnails).
  - Embedded HTML beyond the sanitized snippet.
  - Author/image metadata (kept out of DB to avoid inferred rights).

## 4. Sanitizer Behaviour
- `services/news_legal_sanitizer.py` exposes `sanitize_ingested_entry()` which:
  - Detects full-article dumps via length + HTML heuristics and logs `news_ingest_full_article_detected`.
  - Strips/normalizes HTML, truncates snippets to 360 chars, and falls back to title when content is empty.
  - Emits `SanitizedNewsItem` instances whose `raw_metadata` only includes the permitted fields above.
- `NewsIngestService` now persists only sanitized data (`summary` ← sanitized snippet, `content/image/author` columns set to NULL) and logs `news_ingest_sanitized_item` + `news_ingest_legal_sanitized` for each row.

## 5. Logging & Auditing Events
- `news_source_missing_legal_metadata` – loader-level warning on incomplete configs.
- `news_ingest_legal_validation_failed` – compliance gate rejection (`redistribution_not_allowed`, `x_robots_tag_block`, `robots_txt_block`, etc).
- `news_ingest_legal_validation_passed` – gate ok; includes serialized legal metadata.
- `news_ingest_legal_skip` – paired with failures, records the operational skip.
- `news_ingest_full_article_detected` – sanitizer detected full-text payload; entry trimmed.
- `news_ingest_sanitized_item` – sanitized row emitted (traceability per URL).
- `news_ingest_legal_sanitized` – auditing hook capturing `legal_checks_passed=True/False` per item.

These logs form the sole auditing channel (schema unchanged) and can be aggregated from `ai_logs`/worker logs for compliance review.

