# N3.3 – News Search Endpoint

## Overview
`/api/v1/news/search` enables keyword lookups across diaspora-related articles.  
It relies on PostgreSQL full-text search using the `simple` dictionary and the new `news_search_tsv` generated column created in `015_news_search.sql`. The column weights title (`A`), summary (`B`), and content (`C`) before being indexed with a GIN index for fast lookups.

## Ranking
Results are sorted by a blended score:

```
score = 0.7 * ts_rank(news_search_tsv, query_ts)
        + 0.3 * COALESCE(relevance_diaspora, 0)
```

This favors semantic relevance but still respects AI-calculated diaspora affinity.

## Request
```
GET /api/v1/news/search?q=rotterdam+diaspora&limit=10&offset=0
```

### Query parameters
- `q` (required): search expression (supports `websearch_to_tsquery` syntax), min 2 chars, max 200.
- `limit`: number of items per page (1–50, default 20).
- `offset`: pagination offset (≥0, default 0).

## Response
```
{
  "items": [
    {
      "id": 42,
      "title": "Rotterdam diaspora festival",
      "snippet": "Het festival...",
      "source": "Rotterdam Dagblad",
      "published_at": "2025-11-21T09:15:00Z",
      "url": "https://example.com/festival",
      "image_url": "https://img.example.com/festival.jpg",
      "tags": ["origin", "culture"]
    }
  ],
  "total": 18,
  "limit": 10,
  "offset": 0
}
```

## Performance Notes
- The search endpoint only scans `processing_state='classified'` rows with `published_at IS NOT NULL`.
- The generated column keeps write overhead minimal; the concurrent GIN index (`idx_news_search_tsv`) protects read latency.
- Prefer `websearch_to_tsquery` syntax for user-friendly operators (`"exact phrase"`, `OR`, `-exclude`).




